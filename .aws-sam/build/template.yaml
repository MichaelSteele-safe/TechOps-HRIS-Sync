AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Description: 'Safe API SAM Template

  '
Globals:
  Function:
    Timeout: 900
    MemorySize: 10240
    Handler: index.handler
    Architectures:
    - x86_64
    VpcConfig:
      SecurityGroupIds:
      - sg-2876604a
      SubnetIds:
      - subnet-47784d33
      - subnet-12d98d54
Resources:
  HRISNetsuiteSyncLambda:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName:
        Fn::Join:
        - '-'
        - - REL-hris-sync-netsuite
      Handler: lambda_function.lambda_handler
      CodeUri: HRISNetsuiteSyncLambda
      Role: arn:aws:iam::588146318465:role/REL-Lambda-role
      Runtime: python3.9
      Events:
        ScheduleEvent:
          Type: ScheduleV2
          Properties:
            ScheduleExpression: rate(1 day)
            FlexibleTimeWindow:
              Mode: FLEXIBLE
              MaximumWindowInMinutes: 5
            StartDate: '2023-11-01T09:30:00.000Z'
            ScheduleExpressionTimezone: PST
            RoleArn: arn:aws:iam::588146318465:role/REL-Lambda-role
            RetryPolicy:
              MaximumRetryAttempts: 5
              MaximumEventAgeInSeconds: 300
    Metadata:
      SamResourceId: HRISNetsuiteSyncLambda
  HRISNetsuiteSyncErrorAlarm:
    Type: AWS::CloudWatch::Alarm
    Properties:
      AlarmName: REL-hris-sync-netsuite-alarm
      AlarmDescription: REL-hris-sync-netsuite lambda failed
      Namespace: AWS/Lambda
      MetricName: Errors
      Dimensions:
      - Name: FunctionName
        Value:
          Ref: HRISNetsuiteSyncLambda
      Statistic: Sum
      Period: '300'
      EvaluationPeriods: '1'
      Threshold: '1'
      ComparisonOperator: GreaterThanOrEqualToThreshold
      AlarmActions:
      - arn:aws:sns:us-west-2:588146318465:REL-opsgenie
